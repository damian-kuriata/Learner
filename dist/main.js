(()=>{"use strict";var t,e=new Uint8Array(16);function n(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(t){return"string"==typeof t&&s.test(t)};for(var a=[],i=0;i<256;++i)a.push((i+256).toString(16).substr(1));const o=function(t,e,s){var i=(t=t||{}).random||(t.rng||n)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){s=s||0;for(var o=0;o<16;++o)e[s+o]=i[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]).toLowerCase();if(!r(n))throw TypeError("Stringified UUID is invalid");return n}(i)};class l{constructor(t,e,n=null){this.originalText=t,this.translatedText=e,this.id=n??o().toString().substr(0,5)}checkTranslation(t,e){if((t=t.toLowerCase().trim()).replaceAll("ä","ae"),t.replaceAll("ö","oe"),t.replaceAll("ü","ue"),t.replaceAll("ß","ss"),"to"!==e&&"from"!==e)throw new Error("Wrong direction");let n=this;return n.translatedText=n.translatedText.toLowerCase().trim(),n.translatedText.replaceAll("ä","ae"),n.translatedText.replaceAll("ö","oe"),n.translatedText.replaceAll("ü","ue"),n.translatedText.replaceAll("ß","ss"),n.originalText=n.originalText.toLowerCase().trim(),n.originalText.replaceAll("ä","ae"),n.originalText.replaceAll("ö","oe"),n.originalText.replaceAll("ü","ue"),n.originalText.replaceAll("ß","ss"),"to"===e?t===n.originalText:t===n.translatedText}static localStorageTag="learner_data";static loadFromStorage(t=!0,e=null){let n=JSON.parse(localStorage.getItem(l.localStorageTag));if(!n||0===n.length)return[];let s=n;if(s instanceof Array==0)throw new Error("Data must be array!");let r=s.map((t=>new l(t.originalText,t.translatedText,t.id)));if(t)return r;if(e)return r.find((t=>t.id===e));const a=r.length;return r[Math.floor(Math.random()*(a-0)+0)]}static saveToStorage(t){if(!(t instanceof l))throw new Error("Instance of Phrase required!");let e=l.loadFromStorage(),n=!1;for(let s=0;s<e.length;s++)e[s].id===t.id&&(e[s].originalText=t.originalText,e[s].translatedText=t.translatedText,n=!0);n||e.push(t);let s=JSON.stringify(e);localStorage.setItem(l.localStorageTag,s)}static removeFromStorage(t){let e=l.loadFromStorage(),n=e.findIndex((e=>e.id===t));if(-1===n)throw new Error("Phrase not found");e.splice(n,1),localStorage.setItem(l.localStorageTag,JSON.stringify(e))}}class h{constructor(t="",e=""){this.container=document.querySelector(".phraseInputDialog"),this.originalTextInput=document.querySelector("#originalTextInput"),this.translatedTextInput=document.querySelector("#translatedTextInput"),this.closeButton=document.querySelector("#editCloseButton"),this.confirmButton=document.querySelector("#editConfirmButton"),this.originalTextInput.value=t,this.translatedTextInput.value=e}onOriginalTextInputChange(t){this.originalTextInput.addEventListener("input",(()=>t(this.originalTextInput.value)))}onTranslatedTextInputChange(t){this.translatedTextInput.addEventListener("input",(()=>t(this.translatedTextInput.value)))}onClose(t,e=!0,n=!0){t&&this.closeButton.addEventListener("click",(()=>{console.log("auto close:",e,n),e&&(this.hide(),console.log("this hide")),n&&this.clearInputData(),t()}))}onConfirm(t,e=!0,n=!0){t&&this.confirmButton.addEventListener("click",(()=>{e&&this.hide(),n&&this.clearInputData(),t()}))}show(){this.container.classList.add("displayAbsolute"),this.container.classList.remove("nodisplay")}hide(){console.log("Call hide"),this.container.classList.add("nodisplay"),this.container.classList.remove("displayAbsolute")}clearInputData(t=null){if(t)if("original"===t)this.originalTextInput.value="";else{if("translated"!==t)throw new Error("Unknown input name");this.translatedTextInput=""}else this.originalTextInput.value="",this.translatedTextInput.value=""}}class c{constructor(t){this.listElement=t,this.refresh(l.loadFromStorage())}refresh(t){for(this.phrases=t;this.listElement.firstChild;)this.listElement.removeChild(this.listElement.firstChild);this.phrases.forEach(((t,e)=>{let n=document.createElement("li");const s=t.id;n.setAttribute("id","phrase"+s),n.innerHTML=`\n        <div>\n          <span style="font-weight: bold">${e}. </span>\n          <span>${t.originalText}</span>\n        </div>\n      `;const r=document.createElement("button");r.classList.add("editButton"),r.setAttribute("id","edit"+s),r.addEventListener("click",(()=>{console.log("edit")})),r.textContent="Edit";const a=document.createElement("button");a.classList.add("deleteButton"),a.setAttribute("id","delete"+s),a.addEventListener("click",(()=>{if(this.onPhraseDelete){const t=a.getAttribute("id").slice(6);console.log("Trying to delete: ",t),this.onPhraseDelete(t)}})),a.textContent="X",a.setAttribute("aria-label","Delete phrase"),n.appendChild(r),n.appendChild(a),this.listElement.appendChild(n)}))}}let d=document.querySelector("#learnBtn"),u=document.querySelector("#manageBtn"),g=(document.querySelector("#checkBtn"),document.querySelector("#learnPane")),p=(document.querySelector("#managePane"),new class{constructor(t){this.pane=t,this.shouldLoadNext=!1,this.currentPhrase=null,this.translationDirection,this.translatedPhrase=document.querySelector("#translatedPhrase"),this.learnPhraseInput=document.querySelector("#learnPhraseInput"),this.resultText=document.querySelector("#resultText"),this.checkButton=document.querySelector("#checkBtn"),this.checkButton.addEventListener("click",(()=>{this.checkInput()})),this.nextButton=document.querySelector("#nextButton"),this.nextButton.addEventListener("click",(()=>{this.processOnePhrase()}))}processOnePhrase(){if(this.shouldLoadNext=!1,this.nextButton.classList.add("nodisplay"),this.learnPhraseInput.value="",this.resultText.textContent="",this.translationDirection=Math.floor(2*Math.random())+0,this.translationDirection=0===this.translationDirection?"to":"from",this.currentPhrase=l.loadFromStorage(!1),console.log("Current: ",this.currentPhrase),this.currentPhrase===[])return this.resultText.textContent="At first add phrases!",void(this.currentPhrase=null);"to"===this.translationDirection?this.translatedPhrase.textContent=this.currentPhrase.translatedText:this.translatedPhrase.textContent=this.currentPhrase.originalText}stopLearning(){currentPhrase=null}checkInput(){let t=this.learnPhraseInput.value;this.currentPhrase.checkTranslation(t,this.translationDirection)?this.#t():this.#e()}#t(){this.resultText.textContent="Correct",this.resultText.classList.add("feedbackCorrect"),setTimeout(this.processOnePhrase,2e3)}#e(){this.resultText.textContent="Wrong, correct answer: ","to"===this.translationDirection?this.resultText.textContent+=this.currentPhrase.originalText:this.resultText.textContent+=this.currentPhrase.translatedText,this.resultText.classList.add("feedbackTryAgain"),this.nextButton.classList.remove("nodisplay"),this.nextButton.classList.add("displayBlock"),this.shouldLoadNext=!0}show(){this.pane.classList.remove("inactivePane")}hide(){this.pane.classList.add("inactivePane")}}(g)),T=new class{constructor(t){this.newOriginalText="",this.newTranslatedText="",this.pane=t,this.onNewOriginalTextChange=this.onNewOriginalTextChange.bind(this),this.onNewTranslatedTextChange=this.onNewTranslatedTextChange.bind(this),this.onConfirm=this.onConfirm.bind(this),this.onClose=this.onClose.bind(this),this.newPhraseDialog=new h,this.newPhraseDialog.hide(),this.newPhraseDialog.onOriginalTextInputChange(this.onNewOriginalTextChange),this.newPhraseDialog.onTranslatedTextInputChange(this.onNewTranslatedTextChange),this.newPhraseDialog.onClose(this.onClose),this.newPhraseDialog.onConfirm(this.onConfirm),this.phraseList=new c(document.querySelector("#phrasesList")),this.phraseList.onPhraseDelete=t=>{l.removeFromStorage(t),this.phraseList.refresh(l.loadFromStorage())},this.newButton=document.querySelector("#managePane > button"),this.newButton.addEventListener("click",(()=>{this.newPhraseDialog.show()}))}onNewOriginalTextChange(t){console.log(t),this.newOriginalText=t}onNewTranslatedTextChange(t){this.newTranslatedText=t}onConfirm(){const t=new l(this.newOriginalText,this.newTranslatedTex);l.saveToStorage(t),this.phraseList.refresh(l.loadFromStorage()),this.newOrignalText="",this.newTranslatedText=""}onClose(){this.newOriginalText="",this.newTranslatedText=""}show(){this.pane.classList.remove("inactivePane"),console.log("Storage: ",l.loadFromStorage()),this.phraseList.refresh(l.loadFromStorage())}hide(){this.pane.classList.add("inactivePane")}}(managePane);d.addEventListener("click",(()=>{p.show(),T.hide(),d.classList.add("activeNavBtn"),u.classList.remove("activeNavBtn"),p.processOnePhrase()})),u.addEventListener("click",(()=>{T.show(),p.hide(),u.classList.add("activeNavBtn"),d.classList.remove("activeNavBtn")})),p.processOnePhrase()})();